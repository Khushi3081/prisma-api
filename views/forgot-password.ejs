<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot-password</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      .container {
        width: 1440px;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <body>
      <div id="show"></div>
      <div id="reset"></div>
      <div class="container" id="password">
        <div>
          <h3>Forgot Password</h3>
        </div>
        <form class="row g-3 needs-validation">
          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <label for="inputPassword6" class="col-form-label">E-mail</label>
            </div>
            <div class="col-auto">
              <input
                type="text"
                name="email"
                id="email"
                class="form-control"
                aria-labelledby="passwordHelpInline"
              />
            </div>
          </div>
          <div class="col-12">
            <input
              type="button"
              class="btn btn-primary"
              value="Submit"
              onclick="sendMail()"
            />
          </div>
        </form>
          <script>
            async function sendMail() {
              let email = document.getElementById('email').value;
              let qry_req = await fetch(`/forgot-password/send`, {
                method: 'post',
                headers: {
                  'Content-type': 'application/json',
                },
                body: JSON.stringify({
                  email,
                }),
              });
              let result = await qry_req.json();
              console.log(result);
              if (result) {
                let id = result.user_id;
                document.getElementById('password').style.display = 'none';
                let htmlContent = '';
                htmlContent += `<div class="container">
      <form
        class="row g-3 needs-validation"
        action="/forgot-password/checkOtp"
        method="post"
      >
        <div class="row g-3 align-items-center">
          <div class="col-auto">
            <label for="inputPassword6" class="col-form-label">Enter OTP</label>
          </div>
          <div class="col-auto">
            <input
              type="text"
              name="otp"
              id="otp"
              class="form-control"
              aria-labelledby="passwordHelpInline"
            />
          </div>
        </div>
        <input type="text" style="color:blue" id="ids" value="${id}" hidden>
        <div id="error"></div>

        <div class="col-12">
          <input
            type="button"
            class="btn btn-primary"
            value="Submit"
            onclick="checkOtp()"
          />
        </div>
      </form>
    </div>
  </body>`;
                document.getElementById('show').innerHTML = htmlContent;
              }
            }
          </script>
          <script>
                      async function checkOtp() {
                        console.log("callallas");
                        let id = document.getElementById('ids').value;
                        let otp = document.getElementById('otp').value;
                        let qry_req = await fetch(`/forgot-password/checkOtp`, {
                          method: 'post',
                          headers: {
                            'Content-type': 'application/json',
                          },
                          body: JSON.stringify({
                            otp,
                            id,
                          }),
                        });
                        let result = await qry_req.json();
                        if (result) {
                          let u_id = result.user_id;
                          document.getElementById('show').style.display = 'none';
                          let htmlContent = '';
                          htmlContent +=
                            `<div class="container">
              <form class="row g-3 needs-validation" action="/forgot-password/reset-Password" method="post">
                  <div class="row g-3 align-items-center">
                      <div class="col-auto">
                          <label for="inputPassword6"  class="col-form-label">Password</label>
                        </div>
                        <div class="col-auto">
                          <input type="password" name="password" id="pwd" class="form-control" aria-labelledby="passwordHelpInline">
                        </div>
                      </div>
                <div class="row g-3 align-items-center">
                  <div class="col-auto">
                    <label for="inputPassword6" class="col-form-label"
                      >Confirm Password</label
                    >
                  </div>
                  <div class="col-auto">
                    <input
                      type="password"
                      name="cpassword"
                      id="cpwd"
                      class="form-control"
                      aria-labelledby="passwordHelpInline"
                      onmouseout="return validation()"
                    />
                  </div>
                </div>
                <div id="error"></div>
                <input type="text" value=${u_id} id="u_id" name="u_id" hidden>
                <div class="col-12">
                  <input type="submit" class="btn btn-primary" />
                </div>
              </div>
            </body>`
            document.getElementById('reset').innerHTML = htmlContent;
          }
        }
          </script> 

          <script>
                  async function validation() {
                    const password = document.getElementById('pwd').value;
                    const cpassword = document.getElementById('cpwd').value;
                    if (password != cpassword) {
                      document.getElementById('error').innerHTML =
                        'Confirm password must be same as password';
                      return false;
                    } else {
                      document.getElementById('error').innerHTML = '';
                    }
                  };
            
          </script>
        </form>
      </div>
    </body>
  </body>
</html>
