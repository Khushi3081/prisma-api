<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.all.min.js"></script>
    <style>
      #error {
        color: red;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  </head>

  <body>
    <div class="container">
      <div>
        <h3>Login yourself</h3>
      </div>
      <form class="row g-3 needs-validation" method="post">
        <div class="row g-3 align-items-center">
          <div class="col-auto">
            <label for="inputPassword6" class="col-form-label">E-mail</label>
          </div>
          <div class="col-auto">
            <input
              type="text"
              name="email"
              id="email"
              class="form-control"
              aria-labelledby="passwordHelpInline"
            />
          </div>
        </div>
        <div class="row g-3 align-items-center">
          <div class="col-auto">
            <label for="inputPassword6" class="col-form-label">Password</label>
          </div>
          <div class="col-auto">
            <input
              type="password"
              name="password"
              id="pwd"
              class="form-control"
              aria-labelledby="passwordHelpInline"
            />
          </div>
        </div>
        <br />
        <div>
          <p>Forgot password?</p>
          <a href="/forgot-password">Click Here</a>
        </div>
        <div>
          <a href="/google">Log-in with Google </a>
        </div>
        <div id="error"></div>
        <div class="col-12">
          <input
            type="button"
            class="btn btn-primary"
            value="Submit"
            onclick="generate_token()"
          />
        </div>
        <script>
          async function generate_token() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('pwd').value;
            const qry_req = await fetch(`/login/auth`, {
              method: 'post',
              headers: {
                'content-type': 'application/JSON',
              },
              body: JSON.stringify({
                email: email,
                password: password,
              }),
            });
            response = await qry_req.json();
            if (response.statusCode == 500) {
              swal({
                text: 'Incorrect Credentials!',
                type: 'warning',
              }).then((okay) => {
                if (okay) {
                  window.location.href = '/login';
                }
              });
            } else if (response.data.access_token && response.status == 200) {
              if (response.data.userRole == 'admin') {
                window.location.href = '/admin';
              } else {
                window.location.href = '/main';
              }
            }
          }
        </script>
      </form>
    </div>
  </body>
</html>
